package tests

import (
	"encoding/json"
	"reflect"
	"testing"

	"github.com/AnanievNikolay/test_task/presentation/model"
)

func TestExternalResponseParsing(t *testing.T) {
	jsonStr := "{\"RAW\":{\"BTC\":{\"USD\":{\"TYPE\":\"5\",\"MARKET\":\"CCCAGG\",\"FROMSYMBOL\":\"BTC\",\"TOSYMBOL\":\"USD\",\"FLAGS\":\"1026\",\"PRICE\":47293.21,\"LASTUPDATE\":1612907457,\"MEDIAN\":47287.6,\"LASTVOLUME\":0.02263175,\"LASTVOLUMETO\":1070.2011413,\"LASTTRADEID\":\"1612907457.6755\",\"VOLUMEDAY\":92845.92172857834,\"VOLUMEDAYTO\":4338247307.787131,\"VOLUME24HOUR\":111443.53408456499,\"VOLUME24HOURTO\":5184795135.4528675,\"OPENDAY\":46437.48,\"HIGHDAY\":48209.59,\"LOWDAY\":45051.46,\"OPEN24HOUR\":44689.5,\"HIGH24HOUR\":48219.85,\"LOW24HOUR\":44292.81,\"LASTMARKET\":\"Kraken\",\"VOLUMEHOUR\":1805.9573841229844,\"VOLUMEHOURTO\":85385798.18778643,\"OPENHOUR\":47169.75,\"HIGHHOUR\":47516.85,\"LOWHOUR\":47083.25,\"TOPTIERVOLUME24HOUR\":111442.62669246999,\"TOPTIERVOLUME24HOURTO\":5184752922.101114,\"CHANGE24HOUR\":2603.709999999999,\"CHANGEPCT24HOUR\":5.826223162040298,\"CHANGEDAY\":855.7299999999959,\"CHANGEPCTDAY\":1.8427571866518075,\"CHANGEHOUR\":123.45999999999913,\"CHANGEPCTHOUR\":0.2617355402562005,\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":18624393,\"MKTCAP\":880807329271.53,\"MKTCAPPENALTY\":0,\"TOTALVOLUME24H\":516727.77387137926,\"TOTALVOLUME24HTO\":24351987797.381027,\"TOTALTOPTIERVOLUME24H\":508400.4622123886,\"TOTALTOPTIERVOLUME24HTO\":23958163198.49008,\"IMAGEURL\":\"/media/19633/btc.png\"},\"EUR\":{\"TYPE\":\"5\",\"MARKET\":\"CCCAGG\",\"FROMSYMBOL\":\"BTC\",\"TOSYMBOL\":\"EUR\",\"FLAGS\":\"1026\",\"PRICE\":39066.13,\"LASTUPDATE\":1612907458,\"MEDIAN\":39038.672,\"LASTVOLUME\":0.01,\"LASTVOLUMETO\":390.50550000000004,\"LASTTRADEID\":\"65778\",\"VOLUMEDAY\":26814.136361359273,\"VOLUMEDAYTO\":1036402911.664139,\"VOLUME24HOUR\":30962.892757380007,\"VOLUME24HOURTO\":1193149565.2830703,\"OPENDAY\":38514.1,\"HIGHDAY\":39932.94,\"LOWDAY\":37297.15,\"OPEN24HOUR\":37081.39,\"HIGH24HOUR\":39947.74,\"LOW24HOUR\":36768.29,\"LASTMARKET\":\"lmax\",\"VOLUMEHOUR\":543.5631936800067,\"VOLUMEHOURTO\":21228917.816286653,\"OPENHOUR\":38970.42,\"HIGHHOUR\":39232.81,\"LOWHOUR\":38890.81,\"TOPTIERVOLUME24HOUR\":30960.476821150005,\"TOPTIERVOLUME24HOURTO\":1193058329.1261554,\"CHANGE24HOUR\":1984.739999999998,\"CHANGEPCT24HOUR\":5.352388354373981,\"CHANGEDAY\":552.0299999999988,\"CHANGEPCTDAY\":1.4333192259458194,\"CHANGEHOUR\":95.70999999999913,\"CHANGEPCTHOUR\":0.24559653193370543,\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":18624393,\"MKTCAP\":727582958109.09,\"MKTCAPPENALTY\":0,\"TOTALVOLUME24H\":516727.77387137926,\"TOTALVOLUME24HTO\":20170103560.31711,\"TOTALTOPTIERVOLUME24H\":508400.4622123886,\"TOTALTOPTIERVOLUME24HTO\":19844790865.61838,\"IMAGEURL\":\"/media/19633/btc.png\"}},\"XRP\":{\"USD\":{\"TYPE\":\"5\",\"MARKET\":\"CCCAGG\",\"FROMSYMBOL\":\"XRP\",\"TOSYMBOL\":\"USD\",\"FLAGS\":\"2052\",\"PRICE\":0.4683,\"LASTUPDATE\":1612907449,\"MEDIAN\":0.4683,\"LASTVOLUME\":1460.54888425,\"LASTVOLUMETO\":684.091886405015,\"LASTTRADEID\":\"605871406\",\"VOLUMEDAY\":252012139.82856727,\"VOLUMEDAYTO\":118026183.40721259,\"VOLUME24HOUR\":265046352.91891503,\"VOLUME24HOURTO\":123875328.129885,\"OPENDAY\":0.4518,\"HIGHDAY\":0.4908,\"LOWDAY\":0.4493,\"OPEN24HOUR\":0.4526,\"HIGH24HOUR\":0.4911,\"LOW24HOUR\":0.4442,\"LASTMARKET\":\"Bitfinex\",\"VOLUMEHOUR\":7093390.657392773,\"VOLUMEHOURTO\":3323879.9201738345,\"OPENHOUR\":0.4717,\"HIGHHOUR\":0.4719,\"LOWHOUR\":0.467,\"TOPTIERVOLUME24HOUR\":265046352.91891503,\"TOPTIERVOLUME24HOURTO\":123875328.129885,\"CHANGE24HOUR\":0.015699999999999992,\"CHANGEPCT24HOUR\":3.4688466637207225,\"CHANGEDAY\":0.016500000000000015,\"CHANGEPCTDAY\":3.652058432934931,\"CHANGEHOUR\":-0.003400000000000014,\"CHANGEPCTHOUR\":-0.7207971168115357,\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":99990746204,\"MKTCAP\":46825666447.333206,\"MKTCAPPENALTY\":0,\"TOTALVOLUME24H\":5583810637.522484,\"TOTALVOLUME24HTO\":2614652642.6097364,\"TOTALTOPTIERVOLUME24H\":5393872190.883839,\"TOTALTOPTIERVOLUME24HTO\":2525704468.048859,\"IMAGEURL\":\"/media/34477776/xrp.png\"},\"EUR\":{\"TYPE\":\"5\",\"MARKET\":\"CCCAGG\",\"FROMSYMBOL\":\"XRP\",\"TOSYMBOL\":\"EUR\",\"FLAGS\":\"2052\",\"PRICE\":0.3868,\"LASTUPDATE\":1612907453,\"MEDIAN\":0.38729,\"LASTVOLUME\":206,\"LASTVOLUMETO\":79.64166,\"LASTTRADEID\":\"1612907453.6209\",\"VOLUMEDAY\":164126357.491427,\"VOLUMEDAYTO\":63556156.26935772,\"VOLUME24HOUR\":173142304.4455345,\"VOLUME24HOURTO\":66916168.49471304,\"OPENDAY\":0.3748,\"HIGHDAY\":0.4059,\"LOWDAY\":0.3719,\"OPEN24HOUR\":0.3756,\"HIGH24HOUR\":0.4059,\"LOW24HOUR\":0.3695,\"LASTMARKET\":\"Kraken\",\"VOLUMEHOUR\":6648022.911599803,\"VOLUMEHOURTO\":2573098.580092849,\"OPENHOUR\":0.3898,\"HIGHHOUR\":0.3898,\"LOWHOUR\":0.3856,\"TOPTIERVOLUME24HOUR\":173142304.4455345,\"TOPTIERVOLUME24HOURTO\":66916168.49471304,\"CHANGE24HOUR\":0.011199999999999988,\"CHANGEPCT24HOUR\":2.9818956336528193,\"CHANGEDAY\":0.011999999999999955,\"CHANGEPCTDAY\":3.201707577374588,\"CHANGEHOUR\":-0.0030000000000000027,\"CHANGEPCTHOUR\":-0.7696254489481792,\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":99990746204,\"MKTCAP\":38676420631.7072,\"MKTCAPPENALTY\":0,\"TOTALVOLUME24H\":5583810637.522484,\"TOTALVOLUME24HTO\":2159762679.7288766,\"TOTALTOPTIERVOLUME24H\":5393872190.883839,\"TOTALTOPTIERVOLUME24HTO\":2086294488.569049,\"IMAGEURL\":\"/media/34477776/xrp.png\"}}},\"DISPLAY\":{\"BTC\":{\"USD\":{\"FROMSYMBOL\":\"Ƀ\",\"TOSYMBOL\":\"$\",\"MARKET\":\"CryptoCompare Index\",\"PRICE\":\"$ 47,293.2\",\"LASTUPDATE\":\"Just now\",\"LASTVOLUME\":\"Ƀ 0.02263\",\"LASTVOLUMETO\":\"$ 1,070.20\",\"LASTTRADEID\":\"1612907457.6755\",\"VOLUMEDAY\":\"Ƀ 92,845.9\",\"VOLUMEDAYTO\":\"$ 4,338,247,307.8\",\"VOLUME24HOUR\":\"Ƀ 111,443.5\",\"VOLUME24HOURTO\":\"$ 5,184,795,135.5\",\"OPENDAY\":\"$ 46,437.5\",\"HIGHDAY\":\"$ 48,209.6\",\"LOWDAY\":\"$ 45,051.5\",\"OPEN24HOUR\":\"$ 44,689.5\",\"HIGH24HOUR\":\"$ 48,219.9\",\"LOW24HOUR\":\"$ 44,292.8\",\"LASTMARKET\":\"Kraken\",\"VOLUMEHOUR\":\"Ƀ 1,805.96\",\"VOLUMEHOURTO\":\"$ 85,385,798.2\",\"OPENHOUR\":\"$ 47,169.8\",\"HIGHHOUR\":\"$ 47,516.9\",\"LOWHOUR\":\"$ 47,083.3\",\"TOPTIERVOLUME24HOUR\":\"Ƀ 111,442.6\",\"TOPTIERVOLUME24HOURTO\":\"$ 5,184,752,922.1\",\"CHANGE24HOUR\":\"$ 2,603.71\",\"CHANGEPCT24HOUR\":\"5.83\",\"CHANGEDAY\":\"$ 855.73\",\"CHANGEPCTDAY\":\"1.84\",\"CHANGEHOUR\":\"$ 123.46\",\"CHANGEPCTHOUR\":\"0.26\",\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":\"Ƀ 18,624,393.0\",\"MKTCAP\":\"$ 880.81 B\",\"MKTCAPPENALTY\":\"0 %\",\"TOTALVOLUME24H\":\"Ƀ 516.73 K\",\"TOTALVOLUME24HTO\":\"$ 24.35 B\",\"TOTALTOPTIERVOLUME24H\":\"Ƀ 508.40 K\",\"TOTALTOPTIERVOLUME24HTO\":\"$ 23.96 B\",\"IMAGEURL\":\"/media/19633/btc.png\"},\"EUR\":{\"FROMSYMBOL\":\"Ƀ\",\"TOSYMBOL\":\"€\",\"MARKET\":\"CryptoCompare Index\",\"PRICE\":\"€ 39,066.1\",\"LASTUPDATE\":\"Just now\",\"LASTVOLUME\":\"Ƀ 0.01000\",\"LASTVOLUMETO\":\"€ 390.51\",\"LASTTRADEID\":\"65778\",\"VOLUMEDAY\":\"Ƀ 26,814.1\",\"VOLUMEDAYTO\":\"€ 1,036,402,911.7\",\"VOLUME24HOUR\":\"Ƀ 30,962.9\",\"VOLUME24HOURTO\":\"€ 1,193,149,565.3\",\"OPENDAY\":\"€ 38,514.1\",\"HIGHDAY\":\"€ 39,932.9\",\"LOWDAY\":\"€ 37,297.2\",\"OPEN24HOUR\":\"€ 37,081.4\",\"HIGH24HOUR\":\"€ 39,947.7\",\"LOW24HOUR\":\"€ 36,768.3\",\"LASTMARKET\":\"lmax\",\"VOLUMEHOUR\":\"Ƀ 543.56\",\"VOLUMEHOURTO\":\"€ 21,228,917.8\",\"OPENHOUR\":\"€ 38,970.4\",\"HIGHHOUR\":\"€ 39,232.8\",\"LOWHOUR\":\"€ 38,890.8\",\"TOPTIERVOLUME24HOUR\":\"Ƀ 30,960.5\",\"TOPTIERVOLUME24HOURTO\":\"€ 1,193,058,329.1\",\"CHANGE24HOUR\":\"€ 1,984.74\",\"CHANGEPCT24HOUR\":\"5.35\",\"CHANGEDAY\":\"€ 552.03\",\"CHANGEPCTDAY\":\"1.43\",\"CHANGEHOUR\":\"€ 95.71\",\"CHANGEPCTHOUR\":\"0.25\",\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":\"Ƀ 18,624,393.0\",\"MKTCAP\":\"€ 727.58 B\",\"MKTCAPPENALTY\":\"0 %\",\"TOTALVOLUME24H\":\"Ƀ 516.73 K\",\"TOTALVOLUME24HTO\":\"€ 20.17 B\",\"TOTALTOPTIERVOLUME24H\":\"Ƀ 508.40 K\",\"TOTALTOPTIERVOLUME24HTO\":\"€ 19.84 B\",\"IMAGEURL\":\"/media/19633/btc.png\"}},\"XRP\":{\"USD\":{\"FROMSYMBOL\":\"XRP\",\"TOSYMBOL\":\"$\",\"MARKET\":\"CryptoCompare Index\",\"PRICE\":\"$ 0.4683\",\"LASTUPDATE\":\"Just now\",\"LASTVOLUME\":\"XRP 1,460.55\",\"LASTVOLUMETO\":\"$ 684.09\",\"LASTTRADEID\":\"605871406\",\"VOLUMEDAY\":\"XRP 252,012,139.8\",\"VOLUMEDAYTO\":\"$ 118,026,183.4\",\"VOLUME24HOUR\":\"XRP 265,046,352.9\",\"VOLUME24HOURTO\":\"$ 123,875,328.1\",\"OPENDAY\":\"$ 0.4518\",\"HIGHDAY\":\"$ 0.4908\",\"LOWDAY\":\"$ 0.4493\",\"OPEN24HOUR\":\"$ 0.4526\",\"HIGH24HOUR\":\"$ 0.4911\",\"LOW24HOUR\":\"$ 0.4442\",\"LASTMARKET\":\"Bitfinex\",\"VOLUMEHOUR\":\"XRP 7,093,390.7\",\"VOLUMEHOURTO\":\"$ 3,323,879.9\",\"OPENHOUR\":\"$ 0.4717\",\"HIGHHOUR\":\"$ 0.4719\",\"LOWHOUR\":\"$ 0.4670\",\"TOPTIERVOLUME24HOUR\":\"XRP 265,046,352.9\",\"TOPTIERVOLUME24HOURTO\":\"$ 123,875,328.1\",\"CHANGE24HOUR\":\"$ 0.016\",\"CHANGEPCT24HOUR\":\"3.47\",\"CHANGEDAY\":\"$ 0.017\",\"CHANGEPCTDAY\":\"3.65\",\"CHANGEHOUR\":\"$ -0.0034\",\"CHANGEPCTHOUR\":\"-0.72\",\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":\"XRP 99,990,746,204.0\",\"MKTCAP\":\"$ 46.83 B\",\"MKTCAPPENALTY\":\"0 %\",\"TOTALVOLUME24H\":\"XRP 5.58 B\",\"TOTALVOLUME24HTO\":\"$ 2.61 B\",\"TOTALTOPTIERVOLUME24H\":\"XRP 5.39 B\",\"TOTALTOPTIERVOLUME24HTO\":\"$ 2.53 B\",\"IMAGEURL\":\"/media/34477776/xrp.png\"},\"EUR\":{\"FROMSYMBOL\":\"XRP\",\"TOSYMBOL\":\"€\",\"MARKET\":\"CryptoCompare Index\",\"PRICE\":\"€ 0.3868\",\"LASTUPDATE\":\"Just now\",\"LASTVOLUME\":\"XRP 206.00\",\"LASTVOLUMETO\":\"€ 79.64\",\"LASTTRADEID\":\"1612907453.6209\",\"VOLUMEDAY\":\"XRP 164,126,357.5\",\"VOLUMEDAYTO\":\"€ 63,556,156.3\",\"VOLUME24HOUR\":\"XRP 173,142,304.4\",\"VOLUME24HOURTO\":\"€ 66,916,168.5\",\"OPENDAY\":\"€ 0.3748\",\"HIGHDAY\":\"€ 0.4059\",\"LOWDAY\":\"€ 0.3719\",\"OPEN24HOUR\":\"€ 0.3756\",\"HIGH24HOUR\":\"€ 0.4059\",\"LOW24HOUR\":\"€ 0.3695\",\"LASTMARKET\":\"Kraken\",\"VOLUMEHOUR\":\"XRP 6,648,022.9\",\"VOLUMEHOURTO\":\"€ 2,573,098.6\",\"OPENHOUR\":\"€ 0.3898\",\"HIGHHOUR\":\"€ 0.3898\",\"LOWHOUR\":\"€ 0.3856\",\"TOPTIERVOLUME24HOUR\":\"XRP 173,142,304.4\",\"TOPTIERVOLUME24HOURTO\":\"€ 66,916,168.5\",\"CHANGE24HOUR\":\"€ 0.011\",\"CHANGEPCT24HOUR\":\"2.98\",\"CHANGEDAY\":\"€ 0.012\",\"CHANGEPCTDAY\":\"3.20\",\"CHANGEHOUR\":\"€ -0.0030\",\"CHANGEPCTHOUR\":\"-0.77\",\"CONVERSIONTYPE\":\"direct\",\"CONVERSIONSYMBOL\":\"\",\"SUPPLY\":\"XRP 99,990,746,204.0\",\"MKTCAP\":\"€ 38.68 B\",\"MKTCAPPENALTY\":\"0 %\",\"TOTALVOLUME24H\":\"XRP 5.58 B\",\"TOTALVOLUME24HTO\":\"€ 2.16 B\",\"TOTALTOPTIERVOLUME24H\":\"XRP 5.39 B\",\"TOTALTOPTIERVOLUME24HTO\":\"€ 2.09 B\",\"IMAGEURL\":\"/media/34477776/xrp.png\"}}}}"
	obj := &model.ExternalAPIResponse{}
	json.Unmarshal([]byte(jsonStr), obj)
	usd := obj.Raw["BTC"]["USD"]
	shouldUsd := &model.Currency{
		CHANGE24HOUR:    float64(2603.709999999999),
		CHANGEPCT24HOUR: float64(5.826223162040298),
		OPEN24HOUR:      float64(44689.5),
		VOLUME24HOUR:    float64(111443.53408456499),
		VOLUME24HOURTO:  float64(5184795135.4528675),
		LOW24HOUR:       float64(44292.81),
		HIGH24HOUR:      float64(48219.85),
		PRICE:           float64(47293.21),
		SUPPLY:          float64(18624393),
		MKTCAP:          float64(880807329271.53),
	}
	if !reflect.DeepEqual(shouldUsd, usd) {
		t.Error("Should USD is not equal to USD")
	}
}
